<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin — WHITELINEZ</title>
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body class="dark admin-page">

  <header class="site-header">
    <a href="/index.html" class="logo"><img src="/img/whitelinezlogo.png" alt="WHITELINEZ" /></a>
    <span class="admin-badge">ADMIN</span>
    <nav>
      <a href="/index.html">Public View</a>
      <button id="btn-logout">Logout</button>
    </nav>
  </header>

  <main class="admin-main">

    <!-- Zone draw tool -->
    <section class="admin-section">
      <h2>Count Zone Editor</h2>
      <p class="admin-hint">Click 4 points on the feed (top-left → top-right → bottom-right → bottom-left) to define the counting zone. Only vehicles inside this area are counted. Existing zone loads automatically.</p>

      <div class="stream-canvas-wrapper">
        <video id="admin-video" muted playsinline autoplay></video>
        <canvas id="line-canvas"></canvas>
      </div>

      <div class="admin-line-controls">
        <button id="btn-clear-line" class="btn-secondary">Clear</button>
        <button id="btn-save-line" class="btn-primary" disabled>Save Zone</button>
        <span id="line-status" class="line-status"></span>
      </div>
    </section>

    <!-- Round management -->
    <section class="admin-section">
      <h2>Create Round</h2>
      <form id="round-form">

        <!-- Row 1: what to bet on -->
        <div class="field-row">
          <div class="field">
            <label for="market-type">Bet Type</label>
            <select id="market-type">
              <option value="over_under">Over / Under — total vehicles</option>
              <option value="vehicle_count">Count — specific vehicle type</option>
              <option value="vehicle_type">Type Leader — which type wins</option>
            </select>
          </div>
          <div class="field" id="vehicle-class-field" style="display:none">
            <label for="vehicle-class">Vehicle Type</label>
            <select id="vehicle-class">
              <option value="car">Cars</option>
              <option value="truck">Trucks</option>
              <option value="bus">Buses</option>
              <option value="motorcycle">Motorcycles</option>
            </select>
          </div>
          <div class="field" id="threshold-field">
            <label for="threshold" id="threshold-label">Threshold (vehicles)</label>
            <input id="threshold" type="number" min="1" value="20" />
          </div>
        </div>

        <!-- Row 2: when -->
        <div class="field-row">
          <div class="field">
            <label for="starts-at">Round Starts <small class="muted">(your local time)</small></label>
            <input id="starts-at" type="datetime-local" required />
          </div>
          <div class="field" style="max-width:140px">
            <label for="duration">Duration (min)</label>
            <input id="duration" type="number" min="5" max="480" value="10" />
          </div>
          <div class="field" style="max-width:160px">
            <label for="bet-cutoff">Close bets (min before end)</label>
            <input id="bet-cutoff" type="number" min="0" max="60" value="1" />
          </div>
        </div>

        <!-- Computed time summary -->
        <div class="computed-times" id="computed-times" style="display:none">
          <span>Bets close: <strong id="computed-closes">—</strong></span>
          <span>Round ends: <strong id="computed-ends">—</strong></span>
        </div>

        <!-- Live guardrail preview -->
        <div id="round-preview" class="round-preview hidden">
          <div class="preview-row"><span>Duration</span><strong id="prev-duration">—</strong></div>
          <div class="preview-row"><span>Avg zone vehicles (this hour)</span><strong id="prev-rate">—</strong></div>
          <div class="preview-row" id="prev-expected-row"><span>Expected for window</span><strong id="prev-expected">—</strong></div>
          <div id="prev-warning" class="preview-warning hidden"></div>
          <div id="prev-ok" class="preview-ok hidden">✓ Round looks competitive</div>
        </div>

        <p id="round-error" class="auth-error" role="alert"></p>
        <p id="round-success" class="auth-success" role="status"></p>
        <button type="submit" class="btn-primary" id="round-submit-btn">Create Round</button>
      </form>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1/dist/hls.min.js"></script>
  <script src="/js/config.js"></script>
  <script src="/js/supabase-init.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/stream.js"></script>
  <script src="/js/coord-utils.js"></script>
  <script src="/js/admin-line.js"></script>
  <script src="/js/admin-init.js"></script>
</body>
</html>
